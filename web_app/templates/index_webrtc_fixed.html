<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ëá™ÂãïÁµÑÁ´ã„É≠„Éú„ÉÉ„ÉàÂà∂Âæ° v2.2</title>
    <link rel="stylesheet" href="/static/css/style.css?v=1762686546">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="header">
        <h1>ü§ñ Ëá™ÂãïÁµÑÁ´ã„É≠„Éú„ÉÉ„ÉàÂà∂Âæ°„Ç∑„Çπ„ÉÜ„É† v2.2</h1>
    </div>
    
    <!-- 3„Ç´„É©„É†„É¨„Ç§„Ç¢„Ç¶„Éà -->
    <div class="main-container three-column">
        <!-- Â∑¶„Ç´„É©„É†: „Éì„Éá„Ç™ -->
        <div class="column video-column">
            <div class="video-container">
                <div class="video-wrapper">
                    <div id="connectionStatus" class="status connecting">Êé•Á∂ö‰∏≠...</div>
                    <video id="videoElement" autoplay playsinline muted></video>
                </div>
                <div class="video-controls">
                    <button class="success" onclick="takeSnapshot()">üì∏ „Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà</button>
                    <select id="resolutionSelect" onchange="changeResolution()">
                        <option value="320x240">QVGA (320x240)</option>
                        <option value="640x480" selected>VGA (640x480)</option>
                        <option value="800x600">SVGA (800x600)</option>
                        <option value="1280x720">HD (1280x720)</option>
                        <option value="1920x1080">Full HD (1920x1080)</option>
                    </select>
                    <select id="codecSelect" onchange="changeCodec()">
                        <option value="MJPG" selected>MJPEG</option>
                        <option value="YUYV">YUYV</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- ‰∏≠Â§Æ„Ç´„É©„É†: „É¢„Éã„Çø„Éº -->
        <div class="column monitor-column">
            <!-- ÈõªÊµÅÂÄ§„É¢„Éã„Çø„Éº -->
            <div class="monitor-card">
                <div class="monitor-header">
                    <h2>‚ö° ÈõªÊµÅÂÄ§</h2>
                    <div class="monitor-value">
                        <span id="currentValue">--</span>
                        <span class="unit">mA</span>
                    </div>
                </div>
                <div class="monitor-body">
                    <canvas id="currentChart"></canvas>
                </div>
            </div>
            
            <!-- ÊääÊåÅÁä∂ÊÖãÂà§ÂÆö -->
            <div class="monitor-card">
                <div class="monitor-header">
                    <h2>ü§è ÊääÊåÅÁä∂ÊÖã</h2>
                </div>
                <div class="monitor-body">
                    <div class="grip-status-display">
                        <div class="grip-indicator" id="gripIndicator">
                            <div class="status-led" id="statusLed"></div>
                            <div class="status-text" id="statusText">ÂæÖÊ©ü‰∏≠</div>
                        </div>
                        <div class="grip-details">
                            <div class="detail-item">
                                <span class="detail-label">ÈõªÊµÅÂÄ§:</span>
                                <span class="detail-value" id="gripCurrent">--</span> mA
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">‰ΩçÁΩÆ:</span>
                                <span class="detail-value" id="gripPosition">--</span> mm
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Á©∫ÊåØ„Çä„Éï„É©„Ç∞:</span>
                                <span class="detail-value" id="gripPsfl">--</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Âà§ÂÆöÁêÜÁî±:</span>
                                <span class="detail-value" id="gripReason">--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Âè≥„Ç´„É©„É†: Âà∂Âæ°„Éë„Éç„É´ -->
        <div class="column control-column">
            <!-- 3D„Éó„É™„É≥„Çø„ÉºÂà∂Âæ° -->
            <div class="panel">
                <div class="panel-header" onclick="togglePanel('printer')">
                    <h2>üñ®Ô∏è 3D„Éó„É™„É≥„Çø„Éº</h2>
                    <span class="toggle-icon" id="printer-toggle">‚ñº</span>
                </div>
                <div class="panel-body" id="printer-body">
                    <div class="printer-status">
                        <div class="status-row">
                            <span>Áä∂ÊÖã:</span>
                            <span id="printerState">--</span>
                        </div>
                        <div class="status-row temps">
                            <div>
                                <span>„Éé„Ç∫„É´:</span>
                                <span id="nozzleTemp">--</span>¬∞C
                            </div>
                            <div>
                                <span>„Éô„ÉÉ„Éâ:</span>
                                <span id="bedTemp">--</span>¬∞C
                            </div>
                        </div>
                        <div class="progress-wrapper">
                            <div class="progress-bar">
                                <div class="progress-fill" id="printerProgress"></div>
                            </div>
                            <div class="progress-meta">
                                <span id="progressPercent">0%</span>
                                <span id="progressTime">--</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="file-picker">
                        <select id="gcodeFileSelect"></select>
                        <button onclick="refreshFiles()">üîÑ</button>
                    </div>
                    
                    <div class="button-row tight">
                        <button class="success" onclick="startPrint()">‚ñ∂Ô∏è ÈñãÂßã</button>
                        <button class="secondary" onclick="pausePrint()">‚è∏Ô∏è ‰∏ÄÊôÇÂÅúÊ≠¢</button>
                        <button class="danger" onclick="cancelPrint()">‚èπÔ∏è ‰∏≠Ê≠¢</button>
                    </div>
                    
                    <div class="printer-macro-section">
                        <div class="section-header">
                            <h3>„Éû„ÇØ„É≠</h3>
                            <button class="secondary" onclick="toggleMacroForm()">‚ûï ËøΩÂä†</button>
                        </div>
                        
                        <div id="macroFormWrapper" style="display:none; margin-bottom: 12px;">
                            <div class="macro-form">
                                <input type="text" id="macroName" placeholder="„Éû„ÇØ„É≠Âêç" style="width: 100%; margin-bottom: 8px;">
                                <textarea id="macroCommands" placeholder="G-codeÔºàÊîπË°åÂå∫Âàá„ÇäÔºâ"></textarea>
                                <div class="button-row tight" style="margin-top: 8px;">
                                    <button class="success" onclick="saveMacro()">üíæ ‰øùÂ≠ò</button>
                                    <button class="secondary" onclick="toggleMacroForm()">‚úñÔ∏è „Ç≠„É£„É≥„Çª„É´</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="macro-list" id="macroList"></div>
                    </div>
                </div>
            </div>
            
            <!-- „Ç´„É°„É©„Éë„É©„É°„Éº„Çø -->
            <div class="panel">
                <div class="panel-header" onclick="togglePanel('params')">
                    <h2>üéöÔ∏è „Ç´„É°„É©„Éë„É©„É°„Éº„Çø</h2>
                    <span class="toggle-icon collapsed" id="params-toggle">‚ñº</span>
                </div>
                <div class="panel-body collapsed" id="params-body">
                    <button class="secondary" onclick="resetCameraDefaults()" style="width: 100%; margin-bottom: 10px;">ÔøΩÔøΩ „Éá„Éï„Ç©„É´„Éà„Å´Êàª„Åô</button>
                    <div id="cameraControls" class="controls"></div>
                </div>
            </div>
            
            <!-- „Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà -->
            <div class="panel">
                <div class="panel-header" onclick="togglePanel('snapshots')">
                    <h2>üì∑ „Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà</h2>
                    <span class="toggle-icon collapsed" id="snapshots-toggle">‚ñº</span>
                </div>
                <div class="panel-body collapsed" id="snapshots-body">
                    <button onclick="loadSnapshots()" style="width: 100%; margin-bottom: 10px;">üîÑ ‰∏ÄË¶ßÊõ¥Êñ∞</button>
                    <div id="snapshotsGrid" class="snapshots-grid"></div>
                </div>
            </div>
            
            <!-- „Ç∞„É™„ÉÉ„Éë„ÉºÂà∂Âæ° -->
            <div class="panel">
                <div class="panel-header" onclick="togglePanel('gripper')">
                    <h2>ü§è „Ç∞„É™„ÉÉ„Éë„ÉºÂà∂Âæ°</h2>
                    <span class="toggle-icon collapsed" id="gripper-toggle">‚ñº</span>
                </div>
                <div class="panel-body collapsed" id="gripper-body">
                    <div class="button-row" style="margin-bottom: 10px;">
                        <button onclick="gripperServo('on')">‚ö° „Çµ„Éº„ÉúON</button>
                        <button onclick="gripperServo('off')">‚≠ï „Çµ„Éº„ÉúOFF</button>
                    </div>
                    <button onclick="gripperHome()" style="width: 100%; margin-bottom: 10px;">üè† ÂéüÁÇπÂæ©Â∏∞</button>
                    
                    <div class="control-group">
                        <label>„Éù„Ç∏„Ç∑„Éß„É≥ÁßªÂãï (0-63):</label>
                        <input type="number" id="positionInput" min="0" max="63" value="0">
                        <button onclick="gripperMove()">‚û°Ô∏è ÁßªÂãï</button>
                    </div>
                </div>
            </div>
            
            <!-- „Éù„Ç∏„Ç∑„Éß„É≥„ÉÜ„Éº„Éñ„É´ -->
            <div class="panel">
                <div class="panel-header" onclick="togglePanel('postable')">
                    <h2>üìã „Éù„Ç∏„Ç∑„Éß„É≥„ÉÜ„Éº„Éñ„É´</h2>
                    <span class="toggle-icon collapsed" id="postable-toggle">‚ñº</span>
                </div>
                <div class="panel-body collapsed" id="postable-body">
                    <div class="button-row" style="margin-bottom: 10px;">
                        <button onclick="loadAllPositions()">üì• ÂÖ®‰ª∂Ë™≠Ëæº</button>
                        <button onclick="toggleTableView()">üîÑ Ë°®Á§∫ÂàáÊõø</button>
                    </div>
                    
                    <div id="posTableList" style="display:none;">
                        <div class="postable-container">
                            <table class="postable-table">
                                <thead>
                                    <tr>
                                        <th>Pos</th>
                                        <th>‰ΩçÁΩÆ<br>(mm)</th>
                                        <th>ÂπÖ<br>(mm)</th>
                                        <th>ÈÄüÂ∫¶<br>(mm/s)</th>
                                        <th>Âä†ÈÄü<br>(G)</th>
                                        <th>Ê∏õÈÄü<br>(G)</th>
                                        <th>ÊäºÂΩì<br>(%)</th>
                                    </tr>
                                </thead>
                                <tbody id="posTableBody"></tbody>
                            </table>
                        </div>
                        <div class="pagination" id="pagination"></div>
                    </div>
                    
                    <div id="posTableEdit">
                        <div class="control-group" style="margin-bottom: 10px;">
                            <label>„Éù„Ç∏„Ç∑„Éß„É≥Áï™Âè∑ (0-63):</label>
                            <input type="number" id="posTableSelect" min="0" max="63" value="0">
                            <button onclick="loadPositionTable()">üì• Ë™≠„ÅøËæº„Åø</button>
                        </div>
                        
                        <div id="posTableData" class="controls" style="display:none; margin-top: 10px;">
                            <div class="control-group">
                                <label>ÁõÆÊ®ô‰ΩçÁΩÆ (mm):</label>
                                <input type="number" id="pt_position_mm" min="0" max="4" step="0.01" value="0">
                            </div>
                            <div class="control-group">
                                <label>‰ΩçÁΩÆÊ±∫„ÇÅÂπÖ (mm):</label>
                                <input type="number" id="pt_width_mm" min="0" max="4" step="0.01" value="0.1">
                            </div>
                            <div class="control-group">
                                <label>ÈÄüÂ∫¶ (mm/s):</label>
                                <input type="number" id="pt_speed_mm_s" min="2" max="78" step="0.1" value="50">
                            </div>
                            <div class="control-group">
                                <label>Âä†ÈÄüÂ∫¶ (G):</label>
                                <input type="number" id="pt_accel_g" min="0.01" max="0.3" step="0.01" value="0.3">
                            </div>
                            <div class="control-group">
                                <label>Ê∏õÈÄüÂ∫¶ (G):</label>
                                <input type="number" id="pt_decel_g" min="0.01" max="0.3" step="0.01" value="0.3">
                            </div>
                            <div class="control-group">
                                <label>Êäº‰ªò„ÅëÈõªÊµÅ (%):</label>
                                <input type="number" id="pt_push_current" min="0" max="70" value="0">
                            </div>
                            <button onclick="savePositionTable()" style="width: 100%; margin-top: 5px;">üíæ ‰øùÂ≠ò</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Âõ∫ÂÆö„Ç∞„É™„ÉÉ„Éë„Éº„Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫ -->
    <div id="gripperStatusFixed" class="gripper-status-fixed">
        <div class="status-label">ü§è „Ç∞„É™„ÉÉ„Éë„Éº</div>
        <span id="gripperStatus">‰ΩçÁΩÆ: --mm | „Çµ„Éº„Éú: --</span>
    </div>
    
    <div id="toast" class="toast"></div>
    
    <script src="/static/js/app.js?v=1762686546"></script>
</body>
</html>
